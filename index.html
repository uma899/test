<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Functional Ionic React App</title>

    <link href="https://cdn.jsdelivr.net/npm/@ionic/core/css/ionic.bundle.css" rel="stylesheet">

    <style>
        /* Optional: Dark Mode Base - uncomment to enable */
        /* body {
            --ion-background-color: #121212;
            --ion-background-color-rgb: 18,18,18;
            --ion-text-color: #ffffff;
            --ion-text-color-rgb: 255,255,255;
            --ion-color-step-50: #1f1f1f;
            --ion-color-step-100: #292929;
            --ion-color-step-150: #333333;
            --ion-color-step-200: #3d3d3d;
            --ion-color-step-250: #474747;
            --ion-color-step-300: #515151;
            --ion-color-step-350: #5c5c5c;
            --ion-color-step-400: #666666;
            --ion-color-step-450: #707070;
            --ion-color-step-500: #7a7a7a;
            --ion-color-step-550: #858585;
            --ion-color-step-600: #8f8f8f;
            --ion-color-step-650: #999999;
            --ion-color-step-700: #a3a3a3;
            --ion-color-step-750: #adadad;
            --ion-color-step-800: #b8b8b8;
            --ion-color-step-850: #c2c2c2;
            --ion-color-step-900: #cccccc;
            --ion-color-step-950: #d6d6d6;
            --ion-item-background: #1f1f1f;
            --ion-card-background: #1f1f1f;
            --ion-toolbar-background: #1f1f1f;
            --ion-tab-bar-background: #1f1f1f;
        } */

        /* Custom Primary Color (e.g., a nice green) */
        :root {
            --ion-color-primary: #4CAF50; /* A pleasant green */
            --ion-color-primary-rgb: 76,175,80;
            --ion-color-primary-contrast: #ffffff;
            --ion-color-primary-contrast-rgb: 255,255,255;
            --ion-color-primary-shade: #439c47;
            --ion-color-primary-tint: #5ec263;

            /* Secondary color (e.g., a soft blue) */
            --ion-color-secondary: #03A9F4;
            --ion-color-secondary-rgb: 3,169,244;
            --ion-color-secondary-contrast: #ffffff;
            --ion-color-secondary-contrast-rgb: 255,255,255;
            --ion-color-secondary-shade: #0392d7;
            --ion-color-secondary-tint: #1ccfff;

            /* Tertiary color (e.g., a warm orange) */
            --ion-color-tertiary: #FFC107;
            --ion-color-tertiary-rgb: 255,193,7;
            --ion-color-tertiary-contrast: #000000;
            --ion-color-tertiary-contrast-rgb: 0,0,0;
            --ion-color-tertiary-shade: #e0aa06;
            --ion-color-tertiary-tint: #ffc822;

            /* You can define more colors, e.g., for success, warning, danger, light, medium, dark */
            --ion-color-success: #28a745;
            --ion-color-warning: #ffc107;
            --ion-color-danger: #dc3545;
            --ion-color-light: #f4f5f8;
            --ion-color-medium: #92949c;
            --ion-color-dark: #222428;
        }

        /* General app styling */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            margin: 0;
            /* Using Ionic's own background color variable */
            background: var(--ion-background-color);
            color: var(--ion-text-color);
        }

        /* Specific styling for clarity */
        ion-menu ion-toolbar {
            --background: var(--ion-color-primary);
            --color: var(--ion-color-primary-contrast);
        }
        ion-menu ion-item {
            --background: var(--ion-item-background, var(--ion-background-color));
            --color: var(--ion-text-color);
        }
        ion-fab-button {
            --background: var(--ion-color-secondary);
        }
        ion-toast.custom-toast {
            --background: var(--ion-color-dark);
            --color: var(--ion-color-light);
        }
        ion-loading.custom-loading {
            --background: rgba(var(--ion-color-dark-rgb), 0.7);
            --spinner-color: var(--ion-color-primary);
            --color: var(--ion-color-light);
        }
        ion-alert .alert-wrapper {
            background: var(--ion-background-color);
            color: var(--ion-text-color);
        }
    </style>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <script crossorigin src="https://unpkg.com/@ionic/react@8.0.0/dist/ionic-react.umd.js"></script>

    <script src="https://unpkg.com/@babel/standalone@7/babel.min.js"></script>

</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Ensure Ionic's global components are available for React
        // This is usually handled by @ionic/react setup, but for CDN it's important
        const {
            IonApp, IonPage, IonHeader, IonToolbar, IonTitle, IonContent, IonButtons, IonButton, IonIcon,
            IonSearchbar, IonSegment, IonSegmentButton, IonLabel, IonRefresher, IonRefresherContent,
            IonCard, IonCardHeader, IonCardSubtitle, IonCardTitle, IonCardContent, IonList, IonListHeader,
            IonItemSliding, IonItem, IonItemOptions, IonItemOption, IonBadge, IonFab, IonFabButton,
            IonMenu, IonMenuButton, IonRouterOutlet, IonSplitPane,
            useIonViewWillEnter, useIonViewDidEnter, useIonRouter,
            setupIonicReact, createAnimation,
            // Overlays (need controllers)
            toastController, alertController, loadingController, actionSheetController
        } = IonicReact;

        // Ensure Ionic's React setup is called
        setupIonicReact();

        const { useState, useEffect, useRef } = React;

        // Custom hook for displaying toasts
        const useToast = () => {
            const presentToast = async (message, color = 'primary') => {
                const toast = await toastController.create({
                    message: message,
                    duration: 2000,
                    position: 'bottom',
                    color: color,
                    cssClass: 'custom-toast' // Apply custom styling if needed
                });
                toast.present();
            };
            return { presentToast };
        };

        // Custom hook for displaying loading spinners
        const useLoading = () => {
            const presentLoading = async (message = 'Loading...') => {
                const loading = await loadingController.create({
                    message: message,
                    cssClass: 'custom-loading', // Apply custom styling
                    spinner: 'crescent'
                });
                await loading.present();
                return loading;
            };
            return { presentLoading };
        };

        // Home Page Component
        const HomePage = () => {
            const { presentToast } = useToast();
            const { presentLoading } = useLoading();
            const [tasks, setTasks] = useState([]);
            const [filter, setFilter] = useState('today'); // Default filter

            // Fetch data from JSONPlaceholder
            useEffect(() => {
                const fetchTasks = async () => {
                    const loading = await presentLoading('Fetching tasks...');
                    try {
                        const response = await fetch('https://jsonplaceholder.typicode.com/todos?_limit=10');
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        const data = await response.json();
                        // Map JSONPlaceholder todos to a more 'task-like' structure
                        setTasks(data.map(todo => ({
                            id: todo.id,
                            title: todo.title,
                            completed: todo.completed,
                            dueDate: new Date(Date.now() + todo.id * 86400000).toLocaleDateString() // Simulate due dates
                        })));
                        presentToast('Tasks loaded successfully!', 'success');
                    } catch (error) {
                        console.error("Failed to fetch tasks:", error);
                        presentToast(`Error loading tasks: ${error.message}`, 'danger');
                    } finally {
                        loading.dismiss();
                    }
                };

                fetchTasks();
            }, []); // Empty dependency array means this runs once on mount

            const doRefresh = async (event) => {
                console.log('Begin async refresh operation');
                const loading = await presentLoading('Refreshing data...');
                try {
                    const response = await fetch('https://jsonplaceholder.typicode.com/todos?_limit=10&_start=10'); // Fetch different set
                    if (!response.ok) throw new Error('Network response not ok during refresh');
                    const data = await response.json();
                    setTasks(prevTasks => [
                        ...prevTasks,
                        ...data.map(todo => ({
                            id: todo.id + 100, // Ensure unique IDs
                            title: todo.title + ' (refreshed)',
                            completed: todo.completed,
                            dueDate: new Date(Date.now() + todo.id * 86400000 + 7 * 86400000).toLocaleDateString()
                        }))
                    ]);
                    presentToast('Content refreshed!', 'success');
                } catch (error) {
                    console.error("Refresh failed:", error);
                    presentToast(`Refresh error: ${error.message}`, 'danger');
                } finally {
                    loading.dismiss();
                    event.detail.complete(); // Important: Tell Ionic the refresh is complete
                }
            };

            const markAsComplete = async (itemId) => {
                const alert = await alertController.create({
                    header: 'Mark Complete?',
                    message: 'Are you sure you want to mark this task as complete?',
                    buttons: [
                        { text: 'Cancel', role: 'cancel' },
                        {
                            text: 'Confirm',
                            handler: () => {
                                setTasks(tasks.map(task =>
                                    task.id === itemId ? { ...task, completed: !task.completed } : task
                                ));
                                presentToast('Task status updated!', 'primary');
                            }
                        }
                    ]
                });
                await alert.present();
            };

            const deleteItem = async (itemId) => {
                const alert = await alertController.create({
                    header: 'Delete Task?',
                    message: 'Do you really want to delete this task?',
                    buttons: [
                        { text: 'Cancel', role: 'cancel' },
                        {
                            text: 'Delete',
                            cssClass: 'ion-color-danger',
                            handler: () => {
                                setTasks(tasks.filter(task => task.id !== itemId));
                                presentToast('Task deleted!', 'danger');
                            }
                        }
                    ]
                });
                await alert.present();
            };

            const presentActionSheet = async () => {
                const actionSheet = await actionSheetController.create({
                    header: 'Task Actions',
                    buttons: [
                        {
                            text: 'Add New Task',
                            icon: 'add-circle-outline',
                            handler: () => {
                                presentToast('Add new task clicked!');
                            }
                        },
                        {
                            text: 'Sort Tasks',
                            icon: 'funnel-outline',
                            handler: () => {
                                presentToast('Sort tasks clicked!');
                            }
                        },
                        {
                            text: 'Cancel',
                            icon: 'close',
                            role: 'cancel',
                            handler: () => {
                                console.log('Cancel clicked');
                            }
                        }
                    ]
                });
                await actionSheet.present();
            };

            const filteredTasks = tasks.filter(task => {
                if (filter === 'today') {
                    // Simple check based on simulated due date
                    const today = new Date().toLocaleDateString();
                    return task.dueDate === today && !task.completed;
                } else if (filter === 'upcoming') {
                    const today = new Date().toLocaleDateString();
                    return task.dueDate !== today && !task.completed;
                } else if (filter === 'completed') {
                    return task.completed;
                }
                return true;
            });

            return (
                <IonPage>
                    <IonHeader>
                        <IonToolbar color="primary"> {/* Apply primary color to toolbar */}
                            <IonButtons slot="start">
                                <IonMenuButton />
                            </IonButtons>
                            <IonTitle>My Tasks</IonTitle>
                            <IonButtons slot="end">
                                <IonButton onClick={() => presentToast('Settings clicked!')}>
                                    <IonIcon slot="icon-only" name="settings-outline"></IonIcon>
                                </IonButton>
                            </IonButtons>
                        </IonToolbar>
                        <IonToolbar color="primary">
                            <IonSearchbar placeholder="Search tasks..." animated></IonSearchbar>
                        </IonToolbar>
                        <IonToolbar color="primary">
                            <IonSegment value={filter} onIonChange={e => setFilter(e.detail.value)}>
                                <IonSegmentButton value="today">
                                    <IonLabel>Today</IonLabel>
                                </IonSegmentButton>
                                <IonSegmentButton value="upcoming">
                                    <IonLabel>Upcoming</IonLabel>
                                </IonSegmentButton>
                                <IonSegmentButton value="completed">
                                    <IonLabel>Completed</IonLabel>
                                </IonSegmentButton>
                            </IonSegment>
                        </IonToolbar>
                    </IonHeader>

                    <IonContent fullscreen>
                        <IonRefresher slot="fixed" onIonRefresh={doRefresh}>
                            <IonRefresherContent pullingIcon="arrow-down"
                                                   pullingText="Pull to refresh"
                                                   refreshingSpinner="circular"
                                                   refreshingText="Refreshing...">
                            </IonRefresherContent>
                        </IonRefresher>

                        <div className="ion-padding-vertical">
                            <IonCard>
                                <IonCardHeader>
                                    <IonCardSubtitle>Overview</IonCardSubtitle>
                                    <IonCardTitle>Task Summary</IonCardTitle>
                                </IonCardHeader>
                                <IonCardContent>
                                    You have {filteredTasks.filter(t => !t.completed).length} pending tasks for '{filter}'. Total tasks: {tasks.length}
                                    <IonButton expand="block" fill="clear" color="secondary">View All Details</IonButton>
                                </IonCardContent>
                            </IonCard>
                        </div>

                        <IonList>
                            <IonListHeader>
                                <IonLabel>
                                    {filter === 'today' && "Today's Tasks"}
                                    {filter === 'upcoming' && "Upcoming Tasks"}
                                    {filter === 'completed' && "Completed Tasks"}
                                </IonLabel>
                            </IonListHeader>

                            {filteredTasks.length === 0 ? (
                                <IonItem>
                                    <IonLabel>No tasks found for this filter.</IonLabel>
                                </IonItem>
                            ) : (
                                filteredTasks.map(task => (
                                    <IonItemSliding key={task.id}>
                                        <IonItem lines="inset"> {/* Use lines="inset" for a cleaner look */}
                                            <IonIcon slot="start" name={task.completed ? "checkmark-done-circle" : "ellipse-outline"} color={task.completed ? "success" : "medium"} />
                                            <IonLabel class={task.completed ? 'ion-text-strike' : ''}>
                                                <h2>{task.title}</h2>
                                                <p>Due: {task.dueDate}</p>
                                            </IonLabel>
                                            <IonBadge slot="end" color={task.completed ? "success" : (task.id % 3 === 0 ? "warning" : "primary")}>
                                                {task.completed ? 'Done' : (task.id % 3 === 0 ? 'High' : 'Normal')}
                                            </IonBadge>
                                        </IonItem>
                                        <IonItemOptions side="end">
                                            <IonItemOption color={task.completed ? "warning" : "primary"} onClick={() => markAsComplete(task.id)}>
                                                <IonIcon slot="icon-only" name={task.completed ? "refresh-circle" : "checkmark-circle"}></IonIcon>
                                            </IonItemOption>
                                            <IonItemOption color="danger" onClick={() => deleteItem(task.id)}>
                                                <IonIcon slot="icon-only" name="trash"></IonIcon>
                                            </IonItemOption>
                                        </IonItemOptions>
                                    </IonItemSliding>
                                ))
                            )}
                        </IonList>

                        <div className="ion-text-center ion-padding">
                            <IonButton fill="outline" color="secondary" onClick={() => presentToast('Load more items!')}>
                                Load More
                            </IonButton>
                        </div>

                    </IonContent>

                    <IonFab vertical="bottom" horizontal="end" slot="fixed">
                   